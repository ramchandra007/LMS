{% extends 'hom4.html' %}
{% block page_title %}Manage and Add Subjects{% endblock page_title %}
{% block main_content %}
<style>
    .btn-primary {
        background-color: #0056b3;
        border-color: #0056b3;
        color: #fff;
        transition: background-color 0.3s, border-color 0.3s;
        padding-left: 2rem;
        padding-right: 2rem;
    }

    .btn-primary:hover {
        background-color: #004494;
        border-color: #004494;
    }

    .btn-primary:focus, .btn-primary:active {
        background-color: #003370;
        border-color: #003370;
    }

    .btn-container {
        display: flex;
        align-items: flex-end;
    }
</style>

<div class="container">
    <!-- Section for Adding a Subject -->
    <h1 class="text-primary text-center">Add Subject</h1>
    
    {% if message %}
    <div id="success-message" class="alert alert-success" role="alert">
        {{ message }}
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const successMessage = document.getElementById('success-message');
            if (successMessage) {
                setTimeout(() => {
                    successMessage.style.display = 'none';
                }, 2000);
            }
        });
    </script>
    {% endif %}

    <form method="get" class="mb-3">
        <div class="row">
            <div class="col-md-10">
                <label for="search" class="form-label">Search Subjects:</label>
                <input type="text" id="search" class="form-control" name="search" placeholder="Enter Subject Name" value="{{ search_query }}">
            </div>
            <div class="col-md-2">
                <button type="submit" class="btn btn-primary w-300 mt-4">Search</button>
            </div>
        </div>
    </form>

    <form method="post">
        {% csrf_token %}
        <div class="row mb-3">
            <div class="col-md-5">
                <label for="name" class="form-label">Subject Name:</label>
                <input type="text" id="name" class="form-control" name="name" placeholder="Enter Subject Name" required>
                <datalist id="subject-list">
                    {% for subject in subjects %}
                        <option value="{{ subject.name }}">
                    {% endfor %}
                </datalist>
            </div>

            <div class="col-md-5">
                <label for="school_id" class="form-label">Select School:</label>
                <select id="school_id" class="form-control" name="school_id" required>
                    <option value="" disabled selected>Select a school</option>
                    {% for school in schools %}
                    <option value="{{ school.id }}">{{ school.organizationname }} (ID: {{ school.id }})</option>
                    {% endfor %}
                </select>
            </div>

            <div class="col-md-2 btn-container">
                <button type="submit" class="btn btn-primary w-300">Submit</button>
            </div>
        </div>
    </form>

    <table class="table table-bordered">
        <thead>
            <tr>
                <th>ID</th>
                <th>Subject Name</th>
                <th class="text-center">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for subject in subjects %}
            <tr>
                <td>{{ subject.id }}</td>
                <td>{{ subject.name }}</td>
                <td class="text-center">
                    <a href="{% url 'subject_edit' subject.id %}" class="btn btn-warning">Update</a>
                    <a href="{% url 'sub_delete' subject.id %}" class="btn btn-danger">Delete</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Pagination Controls -->
    <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center">
            {% if subjects.has_previous %}
            <li class="page-item">
                <a class="page-link" href="?page={{ subjects.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}" aria-label="Previous">
                    <span aria-hidden="true">&laquo;</span>
                </a>
            </li>
            {% else %}
            <li class="page-item disabled">
                <a class="page-link" aria-label="Previous">
                    <span aria-hidden="true">&laquo;</span>
                </a>
            </li>
            {% endif %}
            {% for num in subjects.paginator.page_range %}
            <li class="page-item {% if subjects.number == num %}active{% endif %}">
                <a class="page-link" href="?page={{ num }}{% if search_query %}&search={{ search_query }}{% endif %}">{{ num }}</a>
            </li>
            {% endfor %}
            {% if subjects.has_next %}
            <li class="page-item">
                <a class="page-link" href="?page={{ subjects.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}" aria-label="Next">
                    <span aria-hidden="true">&raquo;</span>
                </a>
            </li>
            {% else %}
            <li class="page-item disabled">
                <a class="page-link" aria-label="Next">
                    <span aria-hidden="true">&raquo;</span>
                </a>
            </li>
            {% endif %}
        </ul>
    </nav>
</div>

<script>
    // Auto-suggest functionality for subject name input
    const searchInput = document.getElementById('name');
    const datalist = document.getElementById('subject-list');
    
    searchInput.addEventListener('input', function() {
        const value = this.value.toLowerCase();
        let options = '';
        
        for (let i = 0; i < datalist.options.length; i++) {
            const optionValue = datalist.options[i].value.toLowerCase();
            if (optionValue.includes(value)) {
                options += `<option value="${datalist.options[i].value}">`;
            }
        }
        
        datalist.innerHTML = options;
    });
</script>

{% endblock main_content %}
